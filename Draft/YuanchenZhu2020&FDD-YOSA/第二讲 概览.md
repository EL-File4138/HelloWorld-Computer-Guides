# 第二讲 概览

从头开始介绍一门编程语言总是让我们感到乏味，海潮般的细节会将自身淹没，磨灭学习的兴趣。因此，在本章中，我将会向大家展示一个示例程序，并逐行讲解C语言的工作流程，希望读者能够对C语言有一个整体的认识。

我们要浏览的这个程序能够将任意文件以十六进制格式化地输出到屏幕中，它通过`CMD`获取目标文件的路径以及每行输出的宽度，然后在`CMD`中输出：

CMD中输入的内容：
`./binFile.exe /your/file/path`

如果我们想看看一个`HelloWorld.c`文件是输出的，就在`/your/file/path`中填入它的路径，输出的结果如下，是不是很酷？

![2.1](./Images/2.1.png)

> Offset：偏移量；Bytes：字节；Characters：字符

我们可以看到，输入编译好的文件名`binFile.exe`，加上目标文件的路径`HelloWorld_test.c`和选定的每行宽度，就输出了结果。左侧的偏移量显示了每行开头字节的位置，中间是十六进制显示的字节，右侧是我们实际看到的字符串，它是这样的：

```c
#include <stdio.h>

int main(void){
    printf("Hello World!\n");
    return 0;
}
```

让我们来看看这个程序：

```c
#include <stdio.h>
#include <stdlib.h>
#include <assert.h>
#include <ctype.h>
#include <io.h>

#define LEN 1000
#define OFFSET 30

void binFile(char [LEN], int);
int main(int argc, char *argv[]){
	if(argc != 3){
		printf("usage: %s operation_name file_path offsset_num\n",argv[0]);
		exit(EXIT_FAILURE);
	}
	else{ 
		printf("The result is: \n\n");
		binFile(argv[1], atoi(argv[2]));
		return 0;
	}
}

void binFile(char file_path[LEN], int offset){
	assert(access(file_path, 4) == 0);
	
	int i, j, n;
	unsigned char temp[offset] = {};
	FILE *fp = fopen(file_path, "rb");
	
	printf(" Offset  %*sBytes%*s   %*sCharacters%*s\n", \
		(int)((3*offset-6)/2), " ", (int)((3*offset-6)/2), " ",\
		(int)((offset-10)/2+1), " ", (int)((offset-10)/2), " ");
	printf(" ------   ");
	for(i=0;i<(3*offset-1);i++) printf("%c", '-');
	printf("   ");
	for(i=0;i<offset;i++) printf("%c", '-');
	printf("\n");
	
	j = 0;
	while(1){
		n = fread(temp, sizeof(unsigned char), offset, fp);
		
		printf("  %5d", offset * j);
		j++;
		printf("   ");
		
		for(i=0;i<n;i++){
			if(i == 0) printf("%02X", temp[i]);
			else printf(" %02X", temp[i]);
		}
		if(n < offset){
			for(i=n;i<offset;i++) printf("   ");
		}
		printf("   ");
		
		for(i=0;i<n;i++){
			if(isprint(temp[i]) == 0) printf(".");
			else printf("%c", temp[i]);
		}
		printf("\n");
		
		for(i=0;i<offset+1;i++) temp[i] = '\0';
		if(n < offset) break;
	}
	fclose(fp);
}
```

